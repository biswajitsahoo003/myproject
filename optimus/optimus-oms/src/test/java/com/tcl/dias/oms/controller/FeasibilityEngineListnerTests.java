package com.tcl.dias.oms.controller;

import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

import java.util.Optional;

import org.junit.Before;
import org.junit.FixMethodOrder;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.MethodSorters;
import org.mockito.Mockito;
import org.springframework.amqp.AmqpException;
import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContext;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringRunner;

import com.tcl.dias.common.redis.beans.UserInformation;
import com.tcl.dias.common.utils.MQUtils;
import com.tcl.dias.common.utils.RestClientService;
import com.tcl.dias.oms.consumer.FeasibilityEngineListener;
import com.tcl.dias.oms.entity.entities.PricingEngineResponse;
import com.tcl.dias.oms.entity.entities.QuoteIllSiteSla;
import com.tcl.dias.oms.entity.entities.QuotePrice;
import com.tcl.dias.oms.entity.entities.QuoteToLe;
import com.tcl.dias.oms.entity.entities.SiteFeasibility;
import com.tcl.dias.oms.entity.repository.IllSiteRepository;
import com.tcl.dias.oms.entity.repository.LeProductSlaRepository;
import com.tcl.dias.oms.entity.repository.MstOmsAttributeRepository;
import com.tcl.dias.oms.entity.repository.MstProductComponentRepository;
import com.tcl.dias.oms.entity.repository.MstProductFamilyRepository;
import com.tcl.dias.oms.entity.repository.PricingDetailsRepository;
import com.tcl.dias.oms.entity.repository.ProductAttributeMasterRepository;
import com.tcl.dias.oms.entity.repository.ProductSolutionRepository;
import com.tcl.dias.oms.entity.repository.QuoteIllSiteSlaRepository;
import com.tcl.dias.oms.entity.repository.QuoteLeAttributeValueRepository;
import com.tcl.dias.oms.entity.repository.QuotePriceRepository;
import com.tcl.dias.oms.entity.repository.QuoteProductComponentRepository;
import com.tcl.dias.oms.entity.repository.QuoteProductComponentsAttributeValueRepository;
import com.tcl.dias.oms.entity.repository.QuoteToLeProductFamilyRepository;
import com.tcl.dias.oms.entity.repository.QuoteToLeRepository;
import com.tcl.dias.oms.entity.repository.SiteFeasibilityRepository;
import com.tcl.dias.oms.entity.repository.SlaMasterRepository;
import com.tcl.dias.oms.ill.service.v1.IllPricingFeasibilityService;
import com.tcl.dias.oms.utils.ObjectCreator;
import com.tcl.gvg.exceptionhandler.custom.TclCommonException;

/**
 * This class contains the test cases for feasibulity
 * 
 * @author SEKHAR ER
 *
 * @link http://www.tatacommunications.com
 * @copyright 2018 Tata Communications Limited
 */
@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@FixMethodOrder(MethodSorters.NAME_ASCENDING)
@ContextConfiguration
public class FeasibilityEngineListnerTests {

	@Autowired
	FeasibilityEngineListener feasibilityEngineListner;

	@MockBean
	IllSiteRepository illSiteRepository;
	
	@Autowired
	IllPricingFeasibilityService illPricingFeasibilityService;

	@MockBean
	QuoteToLeProductFamilyRepository quoteToLeProductFamilyRepository;

	@MockBean
	ProductSolutionRepository quoteProductSolutionRepository;

	@Autowired
	ObjectCreator objectCreator;

	@MockBean
	MstOmsAttributeRepository mstOmsAttributeRepository;

	@MockBean
	QuoteLeAttributeValueRepository quoteLeAttributeValueRepository;

	@MockBean
	SiteFeasibilityRepository siteFeasibilityRepository;

	@MockBean
	QuoteToLeRepository quoteToLeRepository;

	@MockBean
	MstProductFamilyRepository mstProductFamilyRepository;

	@MockBean
	ProductAttributeMasterRepository productAttributeMasterRepository;

	@MockBean
	PricingDetailsRepository pricingDetailsRepository;

	@MockBean
	RestClientService restClientService;

	@MockBean
	QuoteProductComponentRepository quoteProductComponentRepository;

	@MockBean
	MstProductComponentRepository mstProductComponentRepository;

	@MockBean
	QuotePriceRepository quotePriceRepository;

	@Autowired
	private ObjectCreator quoteObjectCreator;

	@MockBean
	QuoteProductComponentsAttributeValueRepository quoteProductComponentsAttributeValueRepository;

	@MockBean
	private LeProductSlaRepository leProductSlaRepository;

	@MockBean
	private QuoteIllSiteSlaRepository quoteIllSiteSlaRepository;

	@MockBean
	private SlaMasterRepository slaMasterRepository;

	@MockBean
	MQUtils mqUtils;

	@MockBean
	RabbitTemplate rabbitTemplate;

	@Before
	public void init() throws AmqpException, TclCommonException {
		Mockito.when(quoteToLeRepository.findById(Mockito.anyInt()))
				.thenReturn(Optional.ofNullable(quoteObjectCreator.getQuoteToLe()));
		Mockito.when(mstProductFamilyRepository.findByNameAndStatus(Mockito.anyString(), Mockito.anyByte()))
				.thenReturn(quoteObjectCreator.geProductFamily());
		Mockito.when(leProductSlaRepository.findByErfCustomerLeIdAndMstProductFamily(Mockito.any(), Mockito.any()))
				.thenReturn(quoteObjectCreator.createLeProductSlaList());
		Mockito.when(leProductSlaRepository.findByErfCustomerIdAndMstProductFamily(Mockito.anyInt(), Mockito.any()))
				.thenReturn(quoteObjectCreator.createLeProductSlaList());
		Mockito.when(quoteIllSiteSlaRepository.findByQuoteIllSiteAndSlaMaster(Mockito.any(), Mockito.any()))
				.thenReturn(quoteObjectCreator.createQuoteIllSiteSlaList());
		Mockito.when(quoteIllSiteSlaRepository.findByQuoteIllSite(Mockito.any()))
				.thenReturn(quoteObjectCreator.createQuoteIllSiteSlaList());
		Mockito.when(slaMasterRepository.findBySlaName(Mockito.anyString()))
				.thenReturn(quoteObjectCreator.createSlaMaster());
		Mockito.when(quoteIllSiteSlaRepository.save(Mockito.any())).thenReturn(new QuoteIllSiteSla());
		Mockito.when(rabbitTemplate.convertSendAndReceive(Mockito.anyString(), Mockito.anyString()))
				.thenReturn(quoteObjectCreator.createSLaDetailsBeanList());

		mock(UserInformation.class);
		Authentication authentication = mock(Authentication.class);
		SecurityContext securityContext = mock(SecurityContext.class);
		when(securityContext.getAuthentication()).thenReturn(authentication);
		SecurityContextHolder.setContext(securityContext);
		when(SecurityContextHolder.getContext().getAuthentication().getPrincipal())
				.thenReturn(quoteObjectCreator.getUserInformation());

	}

	/**
	 * 
	 * @throws TclCommonException
	 */
	@Test
	public void testFeasibilityEngineListnerEmptyTest() throws TclCommonException {
		feasibilityEngineListner.processFeasibility("");

	}

	/**
	 * 
	 * @throws TclCommonException
	 */
	@Test
	public void testFeasibilityEngineListnerTest() throws TclCommonException {
		Mockito.when(illSiteRepository.findById(Mockito.anyInt())).thenReturn(Optional.of(objectCreator.getIllsites()));
		Mockito.when(mstOmsAttributeRepository.findByNameAndIsActive(Mockito.anyString(), Mockito.anyByte()))
				.thenReturn(objectCreator.getMstAttributeList());
		Mockito.when(quoteLeAttributeValueRepository.findByQuoteToLeAndMstOmsAttribute(Mockito.any(), Mockito.any()))
				.thenReturn(objectCreator.getQuoteLeAttributeValueList());
		Mockito.when(siteFeasibilityRepository.findByQuoteIllSiteAndFeasibilityMode(Mockito.any(), Mockito.anyString()))
				.thenReturn(objectCreator.getSiteFeasibilities());
		Mockito.when(restClientService.post(Mockito.anyString(), Mockito.any()))
				.thenReturn(objectCreator.cretateResponse());
		Mockito.when(siteFeasibilityRepository.save(Mockito.any())).thenReturn(new SiteFeasibility());
		Mockito.when(quoteToLeRepository.save(Mockito.any())).thenReturn(new QuoteToLe());
		Mockito.when(pricingDetailsRepository.save(Mockito.any())).thenReturn(new PricingEngineResponse());
		Mockito.when(illSiteRepository.findByIdAndStatus(Mockito.anyInt(), Mockito.anyByte()))
				.thenReturn(objectCreator.getQuoteIllSite());

		feasibilityEngineListner.processFeasibility(
				"{\"Feasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"BW_mbps_2\":2.0,\"Service_ID\":0.0,\"total_cost\":132160.0,\"X0.5km_avg_dist\":9999999.0,\"POP_DIST_KM\":0.5100730350500826,\"X0.5km_prospect_avg_bw\":45.2727272727273,\"Latitude_final\":13.0184111,\"OnnetCity_tag\":1.0,\"lm_arc_bw_prov_ofrf\":0.0,\"Network_F_NF_CC\":\"NA\",\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":40000.0,\"Network_Feasibility_Check\":\"Feasible\",\"core_check_CC\":\"NA\",\"X5km_min_bw\":120.0,\"access_check_CC\":\"NA\",\"rank\":10,\"POP_DIST_KM_SERVICE_MOD\":15.0,\"X5km_max_bw\":200.0,\"X5km_prospect_perc_feasible\":0.926775147928994,\"lm_arc_bw_onrf\":0.0,\"POP_Category\":\"Metro Service Ready\",\"lm_nrc_bw_prov_ofrf\":0.0,\"FATG_Building_Type\":\"Commercial\",\"HH_0_5_access_rings_F\":\"NA\",\"hh_flag\":\"NA\",\"local_loop_interface\":\"FE\",\"X5km_prospect_avg_dist\":2738.92671182687,\"latitude_final\":13.0184111,\"FATG_Network_Location_Type\":\"Access\\/Customer POP\",\"topology\":\"primary_active\",\"BW_mbps_act\":2.0,\"city_tier\":\"Non_Tier1\",\"lm_nrc_bw_onwl\":0.0,\"X2km_prospect_min_dist\":2.21569108223123,\"X2km_prospect_perc_feasible\":0.94300518134715,\"X0.5km_prospect_num_feasible\":33.0,\"cpe_supply_type\":\"rental\",\"Orch_Connection\":\"Wireline\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"Capex\":\"NA\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"Burstable_BW\":0.0,\"connected_cust_tag\":0.0,\"net_pre_feasible_flag\":1.0,\"Network_F_NF_CC_Flag\":\"NA\",\"Orch_LM_Type\":\"Onnet\",\"X5km_prospect_avg_bw\":201.780650887574,\"FATG_Category\":\"Metro Service Ready\",\"lm_nrc_mast_ofrf\":0.0,\"Feasibility.Response..Created.Date\":17730.0,\"X2km_prospect_min_bw\":2.0,\"X5km_prospect_num_feasible\":1253.0,\"Selected\":false,\"lm_nrc_mast_onrf\":0.0,\"X5km_prospect_count\":1352.0,\"connection_type\":\"Premium\",\"X0.5km_avg_bw\":9999999.0,\"pool_size\":0,\"X2km_cust_count\":2.0,\"Customer_Segment\":\"Enterprise - Strategic\",\"customer_segment\":\"Enterprise - Strategic\",\"FATG_PROW\":\"No\",\"connected_building_tag\":0.0,\"FATG_DIST_KM\":41.33379039696604,\"X0.5km_prospect_max_bw\":500.0,\"X5km_prospect_min_dist\":2.21569108223123,\"Type\":\"OnnetWL\",\"FATG_Ring_type\":\"SDH\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"scenario_1\":0.0,\"scenario_2\":1.0,\"sno\":3,\"access_check_hh\":\"NA\",\"X2km_prospect_count\":386.0,\"min_hh_fatg\":41.33379039696604,\"POP_Construction_Status\":\"In Service\",\"X5km_avg_dist\":1616.32490273161,\"X2km_avg_dist\":1616.32490273161,\"X2km_prospect_avg_bw\":390.502590673575,\"X0.5km_prospect_min_dist\":2.21569108223123,\"cost_permeter\":0.0,\"Identifier\":\"NA\",\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"X2km_max_bw\":200.0,\"X2km_prospect_max_bw\":10240.0,\"last_mile_contract_term\":\"1 Year\",\"X5km_prospect_min_bw\":0.064,\"X2km_min_bw\":120.0,\"burstable_bw\":0,\"seq_no\":141,\"bw_mbps\":2,\"X0.5km_cust_count\":0.0,\"X0.5km_min_bw\":9999999.0,\"product_name\":\"Internet Access Service\",\"Network_F_NF_HH\":\"NA\",\"HH_0_5_access_rings_NF\":\"NA\",\"X0.5km_min_dist\":9999999.0,\"POP_Building_Type\":\"Commercial\",\"core_check_hh\":\"NA\",\"HH_DIST_KM\":48.632402798319305,\"X0.5km_prospect_min_bw\":2.0,\"POP_DIST_KM_SERVICE\":14.152705282191185,\"lm_arc_bw_onwl\":33350.0,\"num_connected_building\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Capex less than 175m\",\"X0.5km_prospect_avg_dist\":243.087859734992,\"POP_Network_Location_Type\":\"Mega POP\",\"lm_nrc_mux_onwl\":58810.0,\"num_connected_cust\":0.0,\"HH_0_5km\":\"NA\",\"X5km_min_dist\":1424.59360546586,\"feasibility_response_created_date\":\"2018-07-18\",\"X2km_prospect_num_feasible\":364.0,\"additional_ip\":0,\"X2km_avg_bw\":160.0,\"X0.5km_max_bw\":9999999.0,\"X5km_avg_bw\":160.0,\"Status.v2\":\"NA\",\"X5km_prospect_max_bw\":10240.0,\"X2km_prospect_avg_dist\":1361.96557355991,\"cpe_variant\":\"None\",\"Longitude_final\":80.18774819999999,\"X5km_cust_count\":2.0,\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"X0.5km_prospect_perc_feasible\":1.0,\"POP_TCL_Access\":\"Yes\",\"X0.5km_prospect_count\":33.0,\"Probabililty_Access_Feasibility\":0.8533333333333334,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\",\"X2km_min_dist\":1424.59360546586,\"FATG_TCL_Access\":\"No\",\"Network_F_NF_HH_Flag\":\"NA\"},{\"lm_nrc_ospcapex_onwl\":0.0,\"total_cost\":62375.757575757576,\"otc_tikona\":10000.0,\"Latitude_final\":13.0184111,\"lm_arc_bw_prov_ofrf\":35000.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"offnet_5km_Min_accuracy_num\":50.0,\"interim_BW\":2.0,\"offnet_5km_Min_DistanceKilometers\":1.2178610509953627,\"rank\":5,\"offnet_0_5km_Max_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":0.0,\"prospect_0_5km_Min_BW_Mbps\":0.0,\"lm_nrc_bw_prov_ofrf\":10000.0,\"local_loop_interface\":\"FE\",\"bw_flag_32\":0.0,\"arc_tikona\":35000.0,\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"min_mast_ht\":0.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"offnet_2km_Min_DistanceKilometers\":1.2178610509953627,\"prospect_2km_feasibility_pct\":0.7636363636363637,\"Orch_Connection\":\"Wireless\",\"bw_flag_3\":0.0,\"offnet_2km_cust_Count\":2.0,\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4529000280961837,\"offnet_5km_Max_BW_Mbps\":16.0,\"prospect_2km_Sum_Feasibility_flag\":42.0,\"arc_sify\":45000.0,\"prospect_2km_Avg_BW_Mbps\":2.343709090909091,\"Orch_LM_Type\":\"Offnet\",\"max_mast_ht\":27.0,\"lm_nrc_mast_ofrf\":17375.757575757576,\"Feasibility.Response..Created.Date\":17730.0,\"Selected\":true,\"provider_tot_towers\":0.0,\"lm_nrc_mast_onrf\":0.0,\"connection_type\":\"Premium\",\"offnet_2km_Min_BW_Mbps\":0.512,\"pool_size\":0,\"offnet_0_5km_Min_BW_Mbps\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"offnet_5km_Avg_BW_Mbps\":1.7612,\"time_taken\":3.1749999999883585,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Local.Loop.Interface\":\"FE\",\"prospect_2km_cust_Count\":55.0,\"Type\":\"OffnetRF\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"prospect_2km_Max_BW_Mbps\":20.0,\"otc_sify\":15000.0,\"Customer.Segment\":\"Enterprise - Strategic\",\"provider_min_dist\":0.7138602916391107,\"offnet_5km_Min_BW_Mbps\":0.128,\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"avg_mast_ht\":9.696969696969697,\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"burstable_bw\":0,\"bw_mbps\":2,\"prospect_0_5km_Max_BW_Mbps\":0.0,\"offnet_0_5km_Min_accuracy_num\":0.0,\"product_name\":\"Internet Access Service\",\"closest_provider\":\"tikona_min_dist_km\",\"lm_arc_bw_onwl\":0.0,\"nearest_mast_ht_cost\":56400.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Tikona\",\"lm_nrc_mux_onwl\":0.0,\"offnet_2km_Avg_BW_Mbps\":1.256,\"offnet_2km_Min_accuracy_num\":50.0,\"cust_count\":132.0,\"offnet_0_5km_Avg_BW_Mbps\":0.0,\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"nearest_mast_ht\":18.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"Longitude_final\":80.18774819999999,\"Last.Mile.Contract.Term\":\"1 Year\",\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"offnet_0_5km_Min_DistanceKilometers\":99999.0,\"offnet_0_5km_cust_Count\":0.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"Probabililty_Access_Feasibility\":0.9666666666666667,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\"}],\"NotFeasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"Mast_3KM_avg_mast_ht\":9.696969696969697,\"solution_type\":\"UBRP2P\",\"onnet_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_prov_ofrf\":0.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"Mast_3KM_cust_count\":132.0,\"Network_Feasibility_Check\":\"Not Feasible\",\"interim_BW\":0.064,\"onnet_0_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":\"16000\",\"prospect_0_5km_Min_BW_Mbps\":0.0,\"onnet_5km_cust_Count\":0.0,\"lm_nrc_bw_prov_ofrf\":0.0,\"onnet_0_5km_cust_Count\":0.0,\"local_loop_interface\":\"FE\",\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"Mast_3KM_nearest_mast_ht\":9.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"prospect_2km_feasibility_pct\":0.9375,\"Orch_Connection\":\"Wireless\",\"Backhaul_Network_check\":\"Not Feasible\\/ Manual\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"onnet_2km_Avg_BW_Mbps\":0.0,\"opportunity_term\":12,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4655595863714428,\"prospect_2km_Sum_Feasibility_flag\":30.0,\"prospect_2km_Avg_BW_Mbps\":10.845,\"Orch_LM_Type\":\"Onnet\",\"onnet_2km_cust_Count\":0.0,\"lm_nrc_mast_ofrf\":0.0,\"onnet_5km_Max_BW_Mbps\":0.0,\"lm_nrc_mast_onrf\":\"17375.7575757576\",\"connection_type\":\"Premium\",\"onnet_0_5km_Min_DistanceKilometers\":99999.0,\"pool_size\":0,\"Mast_3KM_min_mast_ht\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"Nearest_Mast_ht_cost\":14100.0,\"time_taken\":3.25,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Type\":\"OnnetRF\",\"bts_Closest_Site_type\":\"Roof Top\",\"longitude_final\":80.18774819999999,\"Orch_BW\":0.0,\"LM_OTC_INR\":\"27000\",\"Interface\":\"FE\",\"prospect_2km_Max_BW_Mbps\":300.0,\"onnet_2km_Min_BW_Mbps\":0.0,\"Selected_solution_BW\":0.0,\"prospect_name\":\"Kasturi & Sons Limited\",\"PMP_bts_3km_radius\":0.0,\"Predicted_Access_Feasibility\":\"Not Feasible\",\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"Backhaul_Network_check_reason\":\"UBRP2P Solution\",\"onnet_2km_Avg_DistanceKilometers\":99999.0,\"Avg_3KM_Mast_ht_cost\":17375.757575757576,\"burstable_bw\":0,\"bw_mbps\":2,\"bts_flag\":1.0,\"bts_IP_PMP\":\"Not_in_range\",\"prospect_0_5km_Max_BW_Mbps\":0.0,\"product_name\":\"Internet Access Service\",\"LM_ARC_INR\":\"16000\",\"bts_min_dist_km\":0.7344931438623558,\"lm_arc_bw_onwl\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"UBR P2P - Onnet\",\"lm_nrc_mux_onwl\":0.0,\"bts_num_BTS\":\"TANCHE0158#P2PMP\",\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"Sector_network_check\":\"Feasible\",\"Bandwidth\":\"64K\",\"P2P_bts_3km_radius\":4.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"onnet_5km_Avg_DistanceKilometers\":99999.0,\"sum_no_of_sites_uni_len\":1,\"onnet_2km_Max_BW_Mbps\":0.0,\"onnet_5km_Min_BW_Mbps\":0.0,\"LM_Cost\":60375.757575757576,\"Mast_3KM_max_mast_ht\":27.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"bts_Closest_infra_provider\":\"ATC\",\"Probabililty_Access_Feasibility\":0.43333333333333335,\"lm_nrc_bw_onrf\":\"27000\",\"quotetype_quote\":\"New Order\"}]}");
	}

	/**
	 * 
	 * @throws TclCommonException
	 */
	@Test
	public void testFeasibilityEngineListnerTest1() throws TclCommonException {
		Mockito.when(illSiteRepository.findById(Mockito.anyInt())).thenReturn(Optional.of(objectCreator.getIllsites()));
		Mockito.when(mstOmsAttributeRepository.findByNameAndIsActive(Mockito.anyString(), Mockito.anyByte()))
				.thenReturn(objectCreator.getMstAttributeList());
		Mockito.when(quoteLeAttributeValueRepository.findByQuoteToLeAndMstOmsAttribute(Mockito.any(), Mockito.any()))
				.thenReturn(objectCreator.getQuoteLeAttributeValueList());
		Mockito.when(siteFeasibilityRepository.findByQuoteIllSiteAndFeasibilityMode(Mockito.any(), Mockito.anyString()))
				.thenReturn(objectCreator.getSiteFeasibilities());
		Mockito.when(siteFeasibilityRepository.save(Mockito.any())).thenReturn(new SiteFeasibility());
		Mockito.when(quoteToLeRepository.save(Mockito.any())).thenReturn(new QuoteToLe());
		Mockito.when(pricingDetailsRepository.save(Mockito.any())).thenReturn(new PricingEngineResponse());
		Mockito.when(restClientService.post(Mockito.anyString(), Mockito.any()))
				.thenReturn(objectCreator.cretateResponse());
		Mockito.when(quoteProductComponentRepository.findByReferenceIdAndType(Mockito.anyInt(), Mockito.anyString()))
				.thenReturn(objectCreator.getQuoteProductComponent());
		Mockito.when(mstProductComponentRepository.findById(Mockito.anyInt()))
				.thenReturn(Optional.of(objectCreator.getMstProductComponent()));
		Mockito.when(quotePriceRepository.save(Mockito.any())).thenReturn(new QuotePrice());
		Mockito.when(illSiteRepository.findByIdAndStatus(Mockito.anyInt(), Mockito.anyByte()))
				.thenReturn(objectCreator.getQuoteIllSite());

		feasibilityEngineListner.processFeasibility(
				"{\"Feasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"BW_mbps_2\":2.0,\"Service_ID\":0.0,\"total_cost\":132160.0,\"X0.5km_avg_dist\":9999999.0,\"POP_DIST_KM\":0.5100730350500826,\"X0.5km_prospect_avg_bw\":45.2727272727273,\"Latitude_final\":13.0184111,\"OnnetCity_tag\":1.0,\"lm_arc_bw_prov_ofrf\":0.0,\"Network_F_NF_CC\":\"NA\",\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":40000.0,\"Network_Feasibility_Check\":\"Feasible\",\"core_check_CC\":\"NA\",\"X5km_min_bw\":120.0,\"access_check_CC\":\"NA\",\"rank\":10,\"POP_DIST_KM_SERVICE_MOD\":15.0,\"X5km_max_bw\":200.0,\"X5km_prospect_perc_feasible\":0.926775147928994,\"lm_arc_bw_onrf\":0.0,\"POP_Category\":\"Metro Service Ready\",\"lm_nrc_bw_prov_ofrf\":0.0,\"FATG_Building_Type\":\"Commercial\",\"HH_0_5_access_rings_F\":\"NA\",\"hh_flag\":\"NA\",\"local_loop_interface\":\"FE\",\"X5km_prospect_avg_dist\":2738.92671182687,\"latitude_final\":13.0184111,\"FATG_Network_Location_Type\":\"Access\\/Customer POP\",\"topology\":\"primary_active\",\"BW_mbps_act\":2.0,\"city_tier\":\"Non_Tier1\",\"lm_nrc_bw_onwl\":0.0,\"X2km_prospect_min_dist\":2.21569108223123,\"X2km_prospect_perc_feasible\":0.94300518134715,\"X0.5km_prospect_num_feasible\":33.0,\"cpe_supply_type\":\"rental\",\"Orch_Connection\":\"Wireline\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"Capex\":\"NA\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"Burstable_BW\":0.0,\"connected_cust_tag\":0.0,\"net_pre_feasible_flag\":1.0,\"Network_F_NF_CC_Flag\":\"NA\",\"Orch_LM_Type\":\"Onnet\",\"X5km_prospect_avg_bw\":201.780650887574,\"FATG_Category\":\"Metro Service Ready\",\"lm_nrc_mast_ofrf\":0.0,\"Feasibility.Response..Created.Date\":17730.0,\"X2km_prospect_min_bw\":2.0,\"X5km_prospect_num_feasible\":1253.0,\"Selected\":false,\"lm_nrc_mast_onrf\":0.0,\"X5km_prospect_count\":1352.0,\"connection_type\":\"Premium\",\"X0.5km_avg_bw\":9999999.0,\"pool_size\":0,\"X2km_cust_count\":2.0,\"Customer_Segment\":\"Enterprise - Strategic\",\"customer_segment\":\"Enterprise - Strategic\",\"FATG_PROW\":\"No\",\"connected_building_tag\":0.0,\"FATG_DIST_KM\":41.33379039696604,\"X0.5km_prospect_max_bw\":500.0,\"X5km_prospect_min_dist\":2.21569108223123,\"Type\":\"OnnetWL\",\"FATG_Ring_type\":\"SDH\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"scenario_1\":0.0,\"scenario_2\":1.0,\"sno\":3,\"access_check_hh\":\"NA\",\"X2km_prospect_count\":386.0,\"min_hh_fatg\":41.33379039696604,\"POP_Construction_Status\":\"In Service\",\"X5km_avg_dist\":1616.32490273161,\"X2km_avg_dist\":1616.32490273161,\"X2km_prospect_avg_bw\":390.502590673575,\"X0.5km_prospect_min_dist\":2.21569108223123,\"cost_permeter\":0.0,\"Identifier\":\"NA\",\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"X2km_max_bw\":200.0,\"X2km_prospect_max_bw\":10240.0,\"last_mile_contract_term\":\"1 Year\",\"X5km_prospect_min_bw\":0.064,\"X2km_min_bw\":120.0,\"burstable_bw\":0,\"seq_no\":141,\"bw_mbps\":2,\"X0.5km_cust_count\":0.0,\"X0.5km_min_bw\":9999999.0,\"product_name\":\"Internet Access Service\",\"Network_F_NF_HH\":\"NA\",\"HH_0_5_access_rings_NF\":\"NA\",\"X0.5km_min_dist\":9999999.0,\"POP_Building_Type\":\"Commercial\",\"core_check_hh\":\"NA\",\"HH_DIST_KM\":48.632402798319305,\"X0.5km_prospect_min_bw\":2.0,\"POP_DIST_KM_SERVICE\":14.152705282191185,\"lm_arc_bw_onwl\":33350.0,\"num_connected_building\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Capex less than 175m\",\"X0.5km_prospect_avg_dist\":243.087859734992,\"POP_Network_Location_Type\":\"Mega POP\",\"lm_nrc_mux_onwl\":58810.0,\"num_connected_cust\":0.0,\"HH_0_5km\":\"NA\",\"X5km_min_dist\":1424.59360546586,\"feasibility_response_created_date\":\"2018-07-18\",\"X2km_prospect_num_feasible\":364.0,\"additional_ip\":0,\"X2km_avg_bw\":160.0,\"X0.5km_max_bw\":9999999.0,\"X5km_avg_bw\":160.0,\"Status.v2\":\"NA\",\"X5km_prospect_max_bw\":10240.0,\"X2km_prospect_avg_dist\":1361.96557355991,\"cpe_variant\":\"None\",\"Longitude_final\":80.18774819999999,\"X5km_cust_count\":2.0,\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"X0.5km_prospect_perc_feasible\":1.0,\"POP_TCL_Access\":\"Yes\",\"X0.5km_prospect_count\":33.0,\"Probabililty_Access_Feasibility\":0.8533333333333334,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\",\"X2km_min_dist\":1424.59360546586,\"FATG_TCL_Access\":\"No\",\"Network_F_NF_HH_Flag\":\"NA\"},{\"lm_nrc_ospcapex_onwl\":0.0,\"total_cost\":62375.757575757576,\"otc_tikona\":10000.0,\"Latitude_final\":13.0184111,\"lm_arc_bw_prov_ofrf\":35000.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"offnet_5km_Min_accuracy_num\":50.0,\"interim_BW\":2.0,\"offnet_5km_Min_DistanceKilometers\":1.2178610509953627,\"rank\":5,\"offnet_0_5km_Max_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":0.0,\"prospect_0_5km_Min_BW_Mbps\":0.0,\"lm_nrc_bw_prov_ofrf\":10000.0,\"local_loop_interface\":\"FE\",\"bw_flag_32\":0.0,\"arc_tikona\":35000.0,\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"min_mast_ht\":0.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"offnet_2km_Min_DistanceKilometers\":1.2178610509953627,\"prospect_2km_feasibility_pct\":0.7636363636363637,\"Orch_Connection\":\"Wireless\",\"bw_flag_3\":0.0,\"offnet_2km_cust_Count\":2.0,\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4529000280961837,\"offnet_5km_Max_BW_Mbps\":16.0,\"prospect_2km_Sum_Feasibility_flag\":42.0,\"arc_sify\":45000.0,\"prospect_2km_Avg_BW_Mbps\":2.343709090909091,\"Orch_LM_Type\":\"Offnet\",\"max_mast_ht\":27.0,\"lm_nrc_mast_ofrf\":17375.757575757576,\"Feasibility.Response..Created.Date\":17730.0,\"Selected\":true,\"provider_tot_towers\":0.0,\"lm_nrc_mast_onrf\":0.0,\"connection_type\":\"Premium\",\"offnet_2km_Min_BW_Mbps\":0.512,\"pool_size\":0,\"offnet_0_5km_Min_BW_Mbps\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"offnet_5km_Avg_BW_Mbps\":1.7612,\"time_taken\":3.1749999999883585,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Local.Loop.Interface\":\"FE\",\"prospect_2km_cust_Count\":55.0,\"Type\":\"OffnetRF\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"prospect_2km_Max_BW_Mbps\":20.0,\"otc_sify\":15000.0,\"Customer.Segment\":\"Enterprise - Strategic\",\"provider_min_dist\":0.7138602916391107,\"offnet_5km_Min_BW_Mbps\":0.128,\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"avg_mast_ht\":9.696969696969697,\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"burstable_bw\":0,\"bw_mbps\":2,\"prospect_0_5km_Max_BW_Mbps\":0.0,\"offnet_0_5km_Min_accuracy_num\":0.0,\"product_name\":\"Internet Access Service\",\"closest_provider\":\"tikona_min_dist_km\",\"lm_arc_bw_onwl\":0.0,\"nearest_mast_ht_cost\":56400.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Tikona\",\"lm_nrc_mux_onwl\":0.0,\"offnet_2km_Avg_BW_Mbps\":1.256,\"offnet_2km_Min_accuracy_num\":50.0,\"cust_count\":132.0,\"offnet_0_5km_Avg_BW_Mbps\":0.0,\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"nearest_mast_ht\":18.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"Longitude_final\":80.18774819999999,\"Last.Mile.Contract.Term\":\"1 Year\",\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"offnet_0_5km_Min_DistanceKilometers\":99999.0,\"offnet_0_5km_cust_Count\":0.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"Probabililty_Access_Feasibility\":0.9666666666666667,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\"}],\"NotFeasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"Mast_3KM_avg_mast_ht\":9.696969696969697,\"solution_type\":\"UBRP2P\",\"onnet_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_prov_ofrf\":0.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"Mast_3KM_cust_count\":132.0,\"Network_Feasibility_Check\":\"Not Feasible\",\"interim_BW\":0.064,\"onnet_0_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":\"16000\",\"prospect_0_5km_Min_BW_Mbps\":0.0,\"onnet_5km_cust_Count\":0.0,\"lm_nrc_bw_prov_ofrf\":0.0,\"onnet_0_5km_cust_Count\":0.0,\"local_loop_interface\":\"FE\",\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"Mast_3KM_nearest_mast_ht\":9.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"prospect_2km_feasibility_pct\":0.9375,\"Orch_Connection\":\"Wireless\",\"Backhaul_Network_check\":\"Not Feasible\\/ Manual\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"onnet_2km_Avg_BW_Mbps\":0.0,\"opportunity_term\":12,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4655595863714428,\"prospect_2km_Sum_Feasibility_flag\":30.0,\"prospect_2km_Avg_BW_Mbps\":10.845,\"Orch_LM_Type\":\"Onnet\",\"onnet_2km_cust_Count\":0.0,\"lm_nrc_mast_ofrf\":0.0,\"onnet_5km_Max_BW_Mbps\":0.0,\"lm_nrc_mast_onrf\":\"17375.7575757576\",\"connection_type\":\"Premium\",\"onnet_0_5km_Min_DistanceKilometers\":99999.0,\"pool_size\":0,\"Mast_3KM_min_mast_ht\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"Nearest_Mast_ht_cost\":14100.0,\"time_taken\":3.25,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Type\":\"OnnetRF\",\"bts_Closest_Site_type\":\"Roof Top\",\"longitude_final\":80.18774819999999,\"Orch_BW\":0.0,\"LM_OTC_INR\":\"27000\",\"Interface\":\"FE\",\"prospect_2km_Max_BW_Mbps\":300.0,\"onnet_2km_Min_BW_Mbps\":0.0,\"Selected_solution_BW\":0.0,\"prospect_name\":\"Kasturi & Sons Limited\",\"PMP_bts_3km_radius\":0.0,\"Predicted_Access_Feasibility\":\"Not Feasible\",\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"Backhaul_Network_check_reason\":\"UBRP2P Solution\",\"onnet_2km_Avg_DistanceKilometers\":99999.0,\"Avg_3KM_Mast_ht_cost\":17375.757575757576,\"burstable_bw\":0,\"bw_mbps\":2,\"bts_flag\":1.0,\"bts_IP_PMP\":\"Not_in_range\",\"prospect_0_5km_Max_BW_Mbps\":0.0,\"product_name\":\"Internet Access Service\",\"LM_ARC_INR\":\"16000\",\"bts_min_dist_km\":0.7344931438623558,\"lm_arc_bw_onwl\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"UBR P2P - Onnet\",\"lm_nrc_mux_onwl\":0.0,\"bts_num_BTS\":\"TANCHE0158#P2PMP\",\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"Sector_network_check\":\"Feasible\",\"Bandwidth\":\"64K\",\"P2P_bts_3km_radius\":4.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"onnet_5km_Avg_DistanceKilometers\":99999.0,\"sum_no_of_sites_uni_len\":1,\"onnet_2km_Max_BW_Mbps\":0.0,\"onnet_5km_Min_BW_Mbps\":0.0,\"LM_Cost\":60375.757575757576,\"Mast_3KM_max_mast_ht\":27.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"bts_Closest_infra_provider\":\"ATC\",\"Probabililty_Access_Feasibility\":0.43333333333333335,\"lm_nrc_bw_onrf\":\"27000\",\"quotetype_quote\":\"New Order\"}]}");
	}

	/**
	 * 
	 * @throws TclCommonException
	 */
	@Test
	public void testFeasibilityEngineListnerTestCpe() throws TclCommonException {
		Mockito.when(illSiteRepository.findById(Mockito.anyInt())).thenReturn(Optional.of(objectCreator.getIllsites()));
		Mockito.when(mstOmsAttributeRepository.findByNameAndIsActive(Mockito.anyString(), Mockito.anyByte()))
				.thenReturn(objectCreator.getMstAttributeList());
		Mockito.when(quoteLeAttributeValueRepository.findByQuoteToLeAndMstOmsAttribute(Mockito.any(), Mockito.any()))
				.thenReturn(objectCreator.getQuoteLeAttributeValueList());
		Mockito.when(siteFeasibilityRepository.findByQuoteIllSiteAndFeasibilityMode(Mockito.any(), Mockito.anyString()))
				.thenReturn(objectCreator.getSiteFeasibilities());
		Mockito.when(siteFeasibilityRepository.save(Mockito.any())).thenReturn(new SiteFeasibility());
		Mockito.when(quoteToLeRepository.save(Mockito.any())).thenReturn(new QuoteToLe());
		Mockito.when(pricingDetailsRepository.save(Mockito.any())).thenReturn(new PricingEngineResponse());
		Mockito.when(restClientService.post(Mockito.anyString(), Mockito.any()))
				.thenReturn(objectCreator.cretateResponse());
		Mockito.when(quoteProductComponentRepository.findByReferenceIdAndType(Mockito.anyInt(), Mockito.anyString()))
				.thenReturn(objectCreator.getQuoteProductComponent());
		Mockito.when(mstProductComponentRepository.findById(Mockito.anyInt()))
				.thenReturn(Optional.of(objectCreator.getMstProductComponent1()));
		Mockito.when(quotePriceRepository.save(Mockito.any())).thenReturn(new QuotePrice());
		Mockito.when(illSiteRepository.findByIdAndStatus(Mockito.anyInt(), Mockito.anyByte()))
				.thenReturn(objectCreator.getQuoteIllSite());

		feasibilityEngineListner.processFeasibility(
				"{\"Feasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"BW_mbps_2\":2.0,\"Service_ID\":0.0,\"total_cost\":132160.0,\"X0.5km_avg_dist\":9999999.0,\"POP_DIST_KM\":0.5100730350500826,\"X0.5km_prospect_avg_bw\":45.2727272727273,\"Latitude_final\":13.0184111,\"OnnetCity_tag\":1.0,\"lm_arc_bw_prov_ofrf\":0.0,\"Network_F_NF_CC\":\"NA\",\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":40000.0,\"Network_Feasibility_Check\":\"Feasible\",\"core_check_CC\":\"NA\",\"X5km_min_bw\":120.0,\"access_check_CC\":\"NA\",\"rank\":10,\"POP_DIST_KM_SERVICE_MOD\":15.0,\"X5km_max_bw\":200.0,\"X5km_prospect_perc_feasible\":0.926775147928994,\"lm_arc_bw_onrf\":0.0,\"POP_Category\":\"Metro Service Ready\",\"lm_nrc_bw_prov_ofrf\":0.0,\"FATG_Building_Type\":\"Commercial\",\"HH_0_5_access_rings_F\":\"NA\",\"hh_flag\":\"NA\",\"local_loop_interface\":\"FE\",\"X5km_prospect_avg_dist\":2738.92671182687,\"latitude_final\":13.0184111,\"FATG_Network_Location_Type\":\"Access\\/Customer POP\",\"topology\":\"primary_active\",\"BW_mbps_act\":2.0,\"city_tier\":\"Non_Tier1\",\"lm_nrc_bw_onwl\":0.0,\"X2km_prospect_min_dist\":2.21569108223123,\"X2km_prospect_perc_feasible\":0.94300518134715,\"X0.5km_prospect_num_feasible\":33.0,\"cpe_supply_type\":\"rental\",\"Orch_Connection\":\"Wireline\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"Capex\":\"NA\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"Burstable_BW\":0.0,\"connected_cust_tag\":0.0,\"net_pre_feasible_flag\":1.0,\"Network_F_NF_CC_Flag\":\"NA\",\"Orch_LM_Type\":\"Onnet\",\"X5km_prospect_avg_bw\":201.780650887574,\"FATG_Category\":\"Metro Service Ready\",\"lm_nrc_mast_ofrf\":0.0,\"Feasibility.Response..Created.Date\":17730.0,\"X2km_prospect_min_bw\":2.0,\"X5km_prospect_num_feasible\":1253.0,\"Selected\":false,\"lm_nrc_mast_onrf\":0.0,\"X5km_prospect_count\":1352.0,\"connection_type\":\"Premium\",\"X0.5km_avg_bw\":9999999.0,\"pool_size\":0,\"X2km_cust_count\":2.0,\"Customer_Segment\":\"Enterprise - Strategic\",\"customer_segment\":\"Enterprise - Strategic\",\"FATG_PROW\":\"No\",\"connected_building_tag\":0.0,\"FATG_DIST_KM\":41.33379039696604,\"X0.5km_prospect_max_bw\":500.0,\"X5km_prospect_min_dist\":2.21569108223123,\"Type\":\"OnnetWL\",\"FATG_Ring_type\":\"SDH\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"scenario_1\":0.0,\"scenario_2\":1.0,\"sno\":3,\"access_check_hh\":\"NA\",\"X2km_prospect_count\":386.0,\"min_hh_fatg\":41.33379039696604,\"POP_Construction_Status\":\"In Service\",\"X5km_avg_dist\":1616.32490273161,\"X2km_avg_dist\":1616.32490273161,\"X2km_prospect_avg_bw\":390.502590673575,\"X0.5km_prospect_min_dist\":2.21569108223123,\"cost_permeter\":0.0,\"Identifier\":\"NA\",\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"X2km_max_bw\":200.0,\"X2km_prospect_max_bw\":10240.0,\"last_mile_contract_term\":\"1 Year\",\"X5km_prospect_min_bw\":0.064,\"X2km_min_bw\":120.0,\"burstable_bw\":0,\"seq_no\":141,\"bw_mbps\":2,\"X0.5km_cust_count\":0.0,\"X0.5km_min_bw\":9999999.0,\"product_name\":\"Internet Access Service\",\"Network_F_NF_HH\":\"NA\",\"HH_0_5_access_rings_NF\":\"NA\",\"X0.5km_min_dist\":9999999.0,\"POP_Building_Type\":\"Commercial\",\"core_check_hh\":\"NA\",\"HH_DIST_KM\":48.632402798319305,\"X0.5km_prospect_min_bw\":2.0,\"POP_DIST_KM_SERVICE\":14.152705282191185,\"lm_arc_bw_onwl\":33350.0,\"num_connected_building\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Capex less than 175m\",\"X0.5km_prospect_avg_dist\":243.087859734992,\"POP_Network_Location_Type\":\"Mega POP\",\"lm_nrc_mux_onwl\":58810.0,\"num_connected_cust\":0.0,\"HH_0_5km\":\"NA\",\"X5km_min_dist\":1424.59360546586,\"feasibility_response_created_date\":\"2018-07-18\",\"X2km_prospect_num_feasible\":364.0,\"additional_ip\":0,\"X2km_avg_bw\":160.0,\"X0.5km_max_bw\":9999999.0,\"X5km_avg_bw\":160.0,\"Status.v2\":\"NA\",\"X5km_prospect_max_bw\":10240.0,\"X2km_prospect_avg_dist\":1361.96557355991,\"cpe_variant\":\"None\",\"Longitude_final\":80.18774819999999,\"X5km_cust_count\":2.0,\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"X0.5km_prospect_perc_feasible\":1.0,\"POP_TCL_Access\":\"Yes\",\"X0.5km_prospect_count\":33.0,\"Probabililty_Access_Feasibility\":0.8533333333333334,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\",\"X2km_min_dist\":1424.59360546586,\"FATG_TCL_Access\":\"No\",\"Network_F_NF_HH_Flag\":\"NA\"},{\"lm_nrc_ospcapex_onwl\":0.0,\"total_cost\":62375.757575757576,\"otc_tikona\":10000.0,\"Latitude_final\":13.0184111,\"lm_arc_bw_prov_ofrf\":35000.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"offnet_5km_Min_accuracy_num\":50.0,\"interim_BW\":2.0,\"offnet_5km_Min_DistanceKilometers\":1.2178610509953627,\"rank\":5,\"offnet_0_5km_Max_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":0.0,\"prospect_0_5km_Min_BW_Mbps\":0.0,\"lm_nrc_bw_prov_ofrf\":10000.0,\"local_loop_interface\":\"FE\",\"bw_flag_32\":0.0,\"arc_tikona\":35000.0,\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"min_mast_ht\":0.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"offnet_2km_Min_DistanceKilometers\":1.2178610509953627,\"prospect_2km_feasibility_pct\":0.7636363636363637,\"Orch_Connection\":\"Wireless\",\"bw_flag_3\":0.0,\"offnet_2km_cust_Count\":2.0,\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4529000280961837,\"offnet_5km_Max_BW_Mbps\":16.0,\"prospect_2km_Sum_Feasibility_flag\":42.0,\"arc_sify\":45000.0,\"prospect_2km_Avg_BW_Mbps\":2.343709090909091,\"Orch_LM_Type\":\"Offnet\",\"max_mast_ht\":27.0,\"lm_nrc_mast_ofrf\":17375.757575757576,\"Feasibility.Response..Created.Date\":17730.0,\"Selected\":true,\"provider_tot_towers\":0.0,\"lm_nrc_mast_onrf\":0.0,\"connection_type\":\"Premium\",\"offnet_2km_Min_BW_Mbps\":0.512,\"pool_size\":0,\"offnet_0_5km_Min_BW_Mbps\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"offnet_5km_Avg_BW_Mbps\":1.7612,\"time_taken\":3.1749999999883585,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Local.Loop.Interface\":\"FE\",\"prospect_2km_cust_Count\":55.0,\"Type\":\"OffnetRF\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"prospect_2km_Max_BW_Mbps\":20.0,\"otc_sify\":15000.0,\"Customer.Segment\":\"Enterprise - Strategic\",\"provider_min_dist\":0.7138602916391107,\"offnet_5km_Min_BW_Mbps\":0.128,\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"avg_mast_ht\":9.696969696969697,\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"burstable_bw\":0,\"bw_mbps\":2,\"prospect_0_5km_Max_BW_Mbps\":0.0,\"offnet_0_5km_Min_accuracy_num\":0.0,\"product_name\":\"Internet Access Service\",\"closest_provider\":\"tikona_min_dist_km\",\"lm_arc_bw_onwl\":0.0,\"nearest_mast_ht_cost\":56400.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Tikona\",\"lm_nrc_mux_onwl\":0.0,\"offnet_2km_Avg_BW_Mbps\":1.256,\"offnet_2km_Min_accuracy_num\":50.0,\"cust_count\":132.0,\"offnet_0_5km_Avg_BW_Mbps\":0.0,\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"nearest_mast_ht\":18.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"Longitude_final\":80.18774819999999,\"Last.Mile.Contract.Term\":\"1 Year\",\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"offnet_0_5km_Min_DistanceKilometers\":99999.0,\"offnet_0_5km_cust_Count\":0.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"Probabililty_Access_Feasibility\":0.9666666666666667,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\"}],\"NotFeasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"Mast_3KM_avg_mast_ht\":9.696969696969697,\"solution_type\":\"UBRP2P\",\"onnet_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_prov_ofrf\":0.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"Mast_3KM_cust_count\":132.0,\"Network_Feasibility_Check\":\"Not Feasible\",\"interim_BW\":0.064,\"onnet_0_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":\"16000\",\"prospect_0_5km_Min_BW_Mbps\":0.0,\"onnet_5km_cust_Count\":0.0,\"lm_nrc_bw_prov_ofrf\":0.0,\"onnet_0_5km_cust_Count\":0.0,\"local_loop_interface\":\"FE\",\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"Mast_3KM_nearest_mast_ht\":9.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"prospect_2km_feasibility_pct\":0.9375,\"Orch_Connection\":\"Wireless\",\"Backhaul_Network_check\":\"Not Feasible\\/ Manual\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"onnet_2km_Avg_BW_Mbps\":0.0,\"opportunity_term\":12,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4655595863714428,\"prospect_2km_Sum_Feasibility_flag\":30.0,\"prospect_2km_Avg_BW_Mbps\":10.845,\"Orch_LM_Type\":\"Onnet\",\"onnet_2km_cust_Count\":0.0,\"lm_nrc_mast_ofrf\":0.0,\"onnet_5km_Max_BW_Mbps\":0.0,\"lm_nrc_mast_onrf\":\"17375.7575757576\",\"connection_type\":\"Premium\",\"onnet_0_5km_Min_DistanceKilometers\":99999.0,\"pool_size\":0,\"Mast_3KM_min_mast_ht\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"Nearest_Mast_ht_cost\":14100.0,\"time_taken\":3.25,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Type\":\"OnnetRF\",\"bts_Closest_Site_type\":\"Roof Top\",\"longitude_final\":80.18774819999999,\"Orch_BW\":0.0,\"LM_OTC_INR\":\"27000\",\"Interface\":\"FE\",\"prospect_2km_Max_BW_Mbps\":300.0,\"onnet_2km_Min_BW_Mbps\":0.0,\"Selected_solution_BW\":0.0,\"prospect_name\":\"Kasturi & Sons Limited\",\"PMP_bts_3km_radius\":0.0,\"Predicted_Access_Feasibility\":\"Not Feasible\",\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"Backhaul_Network_check_reason\":\"UBRP2P Solution\",\"onnet_2km_Avg_DistanceKilometers\":99999.0,\"Avg_3KM_Mast_ht_cost\":17375.757575757576,\"burstable_bw\":0,\"bw_mbps\":2,\"bts_flag\":1.0,\"bts_IP_PMP\":\"Not_in_range\",\"prospect_0_5km_Max_BW_Mbps\":0.0,\"product_name\":\"Internet Access Service\",\"LM_ARC_INR\":\"16000\",\"bts_min_dist_km\":0.7344931438623558,\"lm_arc_bw_onwl\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"UBR P2P - Onnet\",\"lm_nrc_mux_onwl\":0.0,\"bts_num_BTS\":\"TANCHE0158#P2PMP\",\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"Sector_network_check\":\"Feasible\",\"Bandwidth\":\"64K\",\"P2P_bts_3km_radius\":4.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"onnet_5km_Avg_DistanceKilometers\":99999.0,\"sum_no_of_sites_uni_len\":1,\"onnet_2km_Max_BW_Mbps\":0.0,\"onnet_5km_Min_BW_Mbps\":0.0,\"LM_Cost\":60375.757575757576,\"Mast_3KM_max_mast_ht\":27.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"bts_Closest_infra_provider\":\"ATC\",\"Probabililty_Access_Feasibility\":0.43333333333333335,\"lm_nrc_bw_onrf\":\"27000\",\"quotetype_quote\":\"New Order\"}]}");
	}

	/**
	 * 
	 * @throws TclCommonException
	 */
	@Test
	public void testFeasibilityEngineListnerTestLastmile() throws TclCommonException {
		Mockito.when(illSiteRepository.findById(Mockito.anyInt())).thenReturn(Optional.of(objectCreator.getIllsites()));
		Mockito.when(mstOmsAttributeRepository.findByNameAndIsActive(Mockito.anyString(), Mockito.anyByte()))
				.thenReturn(objectCreator.getMstAttributeList());
		Mockito.when(quoteLeAttributeValueRepository.findByQuoteToLeAndMstOmsAttribute(Mockito.any(), Mockito.any()))
				.thenReturn(objectCreator.getQuoteLeAttributeValueList());
		Mockito.when(siteFeasibilityRepository.findByQuoteIllSiteAndFeasibilityMode(Mockito.any(), Mockito.anyString()))
				.thenReturn(objectCreator.getSiteFeasibilities());
		Mockito.when(siteFeasibilityRepository.save(Mockito.any())).thenReturn(new SiteFeasibility());
		Mockito.when(quoteToLeRepository.save(Mockito.any())).thenReturn(new QuoteToLe());
		Mockito.when(pricingDetailsRepository.save(Mockito.any())).thenReturn(new PricingEngineResponse());
		Mockito.when(restClientService.post(Mockito.anyString(), Mockito.any()))
				.thenReturn(objectCreator.cretateResponse());
		Mockito.when(quoteProductComponentRepository.findByReferenceIdAndType(Mockito.anyInt(), Mockito.anyString()))
				.thenReturn(objectCreator.getQuoteProductComponent());
		Mockito.when(mstProductComponentRepository.findById(Mockito.anyInt()))
				.thenReturn(Optional.of(objectCreator.getMstProductComponent2()));
		Mockito.when(quotePriceRepository.save(Mockito.any())).thenReturn(new QuotePrice());
		Mockito.when(illSiteRepository.findByIdAndStatus(Mockito.anyInt(), Mockito.anyByte()))
				.thenReturn(objectCreator.getQuoteIllSite());
		Mockito.when(quoteProductComponentsAttributeValueRepository
				.findByQuoteProductComponent_Id(Mockito.anyInt()))
				.thenReturn(objectCreator.getquoteProductComponentAttributeValues());
		Mockito.when(productAttributeMasterRepository.findById(Mockito.anyInt()))
				.thenReturn(Optional.of(objectCreator.getProductAtrributeMas()));
		Mockito.when(quotePriceRepository.findByReferenceIdAndReferenceName(Mockito.anyString(), Mockito.anyString()))
				.thenReturn(objectCreator.getQuotePrice());
		Mockito.when(quotePriceRepository.save(Mockito.any())).thenReturn(new QuotePrice());

		feasibilityEngineListner.processFeasibility(
				"{\"Feasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"BW_mbps_2\":2.0,\"Service_ID\":0.0,\"total_cost\":132160.0,\"X0.5km_avg_dist\":9999999.0,\"POP_DIST_KM\":0.5100730350500826,\"X0.5km_prospect_avg_bw\":45.2727272727273,\"Latitude_final\":13.0184111,\"OnnetCity_tag\":1.0,\"lm_arc_bw_prov_ofrf\":0.0,\"Network_F_NF_CC\":\"NA\",\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":40000.0,\"Network_Feasibility_Check\":\"Feasible\",\"core_check_CC\":\"NA\",\"X5km_min_bw\":120.0,\"access_check_CC\":\"NA\",\"rank\":10,\"POP_DIST_KM_SERVICE_MOD\":15.0,\"X5km_max_bw\":200.0,\"X5km_prospect_perc_feasible\":0.926775147928994,\"lm_arc_bw_onrf\":0.0,\"POP_Category\":\"Metro Service Ready\",\"lm_nrc_bw_prov_ofrf\":0.0,\"FATG_Building_Type\":\"Commercial\",\"HH_0_5_access_rings_F\":\"NA\",\"hh_flag\":\"NA\",\"local_loop_interface\":\"FE\",\"X5km_prospect_avg_dist\":2738.92671182687,\"latitude_final\":13.0184111,\"FATG_Network_Location_Type\":\"Access\\/Customer POP\",\"topology\":\"primary_active\",\"BW_mbps_act\":2.0,\"city_tier\":\"Non_Tier1\",\"lm_nrc_bw_onwl\":0.0,\"X2km_prospect_min_dist\":2.21569108223123,\"X2km_prospect_perc_feasible\":0.94300518134715,\"X0.5km_prospect_num_feasible\":33.0,\"cpe_supply_type\":\"rental\",\"Orch_Connection\":\"Wireline\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"Capex\":\"NA\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"Burstable_BW\":0.0,\"connected_cust_tag\":0.0,\"net_pre_feasible_flag\":1.0,\"Network_F_NF_CC_Flag\":\"NA\",\"Orch_LM_Type\":\"Onnet\",\"X5km_prospect_avg_bw\":201.780650887574,\"FATG_Category\":\"Metro Service Ready\",\"lm_nrc_mast_ofrf\":0.0,\"Feasibility.Response..Created.Date\":17730.0,\"X2km_prospect_min_bw\":2.0,\"X5km_prospect_num_feasible\":1253.0,\"Selected\":false,\"lm_nrc_mast_onrf\":0.0,\"X5km_prospect_count\":1352.0,\"connection_type\":\"Premium\",\"X0.5km_avg_bw\":9999999.0,\"pool_size\":0,\"X2km_cust_count\":2.0,\"Customer_Segment\":\"Enterprise - Strategic\",\"customer_segment\":\"Enterprise - Strategic\",\"FATG_PROW\":\"No\",\"connected_building_tag\":0.0,\"FATG_DIST_KM\":41.33379039696604,\"X0.5km_prospect_max_bw\":500.0,\"X5km_prospect_min_dist\":2.21569108223123,\"Type\":\"OnnetWL\",\"FATG_Ring_type\":\"SDH\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"scenario_1\":0.0,\"scenario_2\":1.0,\"sno\":3,\"access_check_hh\":\"NA\",\"X2km_prospect_count\":386.0,\"min_hh_fatg\":41.33379039696604,\"POP_Construction_Status\":\"In Service\",\"X5km_avg_dist\":1616.32490273161,\"X2km_avg_dist\":1616.32490273161,\"X2km_prospect_avg_bw\":390.502590673575,\"X0.5km_prospect_min_dist\":2.21569108223123,\"cost_permeter\":0.0,\"Identifier\":\"NA\",\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"X2km_max_bw\":200.0,\"X2km_prospect_max_bw\":10240.0,\"last_mile_contract_term\":\"1 Year\",\"X5km_prospect_min_bw\":0.064,\"X2km_min_bw\":120.0,\"burstable_bw\":0,\"seq_no\":141,\"bw_mbps\":2,\"X0.5km_cust_count\":0.0,\"X0.5km_min_bw\":9999999.0,\"product_name\":\"Internet Access Service\",\"Network_F_NF_HH\":\"NA\",\"HH_0_5_access_rings_NF\":\"NA\",\"X0.5km_min_dist\":9999999.0,\"POP_Building_Type\":\"Commercial\",\"core_check_hh\":\"NA\",\"HH_DIST_KM\":48.632402798319305,\"X0.5km_prospect_min_bw\":2.0,\"POP_DIST_KM_SERVICE\":14.152705282191185,\"lm_arc_bw_onwl\":33350.0,\"num_connected_building\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Capex less than 175m\",\"X0.5km_prospect_avg_dist\":243.087859734992,\"POP_Network_Location_Type\":\"Mega POP\",\"lm_nrc_mux_onwl\":58810.0,\"num_connected_cust\":0.0,\"HH_0_5km\":\"NA\",\"X5km_min_dist\":1424.59360546586,\"feasibility_response_created_date\":\"2018-07-18\",\"X2km_prospect_num_feasible\":364.0,\"additional_ip\":0,\"X2km_avg_bw\":160.0,\"X0.5km_max_bw\":9999999.0,\"X5km_avg_bw\":160.0,\"Status.v2\":\"NA\",\"X5km_prospect_max_bw\":10240.0,\"X2km_prospect_avg_dist\":1361.96557355991,\"cpe_variant\":\"None\",\"Longitude_final\":80.18774819999999,\"X5km_cust_count\":2.0,\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"X0.5km_prospect_perc_feasible\":1.0,\"POP_TCL_Access\":\"Yes\",\"X0.5km_prospect_count\":33.0,\"Probabililty_Access_Feasibility\":0.8533333333333334,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\",\"X2km_min_dist\":1424.59360546586,\"FATG_TCL_Access\":\"No\",\"Network_F_NF_HH_Flag\":\"NA\"},{\"lm_nrc_ospcapex_onwl\":0.0,\"total_cost\":62375.757575757576,\"otc_tikona\":10000.0,\"Latitude_final\":13.0184111,\"lm_arc_bw_prov_ofrf\":35000.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"offnet_5km_Min_accuracy_num\":50.0,\"interim_BW\":2.0,\"offnet_5km_Min_DistanceKilometers\":1.2178610509953627,\"rank\":5,\"offnet_0_5km_Max_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":0.0,\"prospect_0_5km_Min_BW_Mbps\":0.0,\"lm_nrc_bw_prov_ofrf\":10000.0,\"local_loop_interface\":\"FE\",\"bw_flag_32\":0.0,\"arc_tikona\":35000.0,\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"min_mast_ht\":0.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"offnet_2km_Min_DistanceKilometers\":1.2178610509953627,\"prospect_2km_feasibility_pct\":0.7636363636363637,\"Orch_Connection\":\"Wireless\",\"bw_flag_3\":0.0,\"offnet_2km_cust_Count\":2.0,\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4529000280961837,\"offnet_5km_Max_BW_Mbps\":16.0,\"prospect_2km_Sum_Feasibility_flag\":42.0,\"arc_sify\":45000.0,\"prospect_2km_Avg_BW_Mbps\":2.343709090909091,\"Orch_LM_Type\":\"Offnet\",\"max_mast_ht\":27.0,\"lm_nrc_mast_ofrf\":17375.757575757576,\"Feasibility.Response..Created.Date\":17730.0,\"Selected\":true,\"provider_tot_towers\":0.0,\"lm_nrc_mast_onrf\":0.0,\"connection_type\":\"Premium\",\"offnet_2km_Min_BW_Mbps\":0.512,\"pool_size\":0,\"offnet_0_5km_Min_BW_Mbps\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"offnet_5km_Avg_BW_Mbps\":1.7612,\"time_taken\":3.1749999999883585,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Local.Loop.Interface\":\"FE\",\"prospect_2km_cust_Count\":55.0,\"Type\":\"OffnetRF\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"prospect_2km_Max_BW_Mbps\":20.0,\"otc_sify\":15000.0,\"Customer.Segment\":\"Enterprise - Strategic\",\"provider_min_dist\":0.7138602916391107,\"offnet_5km_Min_BW_Mbps\":0.128,\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"avg_mast_ht\":9.696969696969697,\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"burstable_bw\":0,\"bw_mbps\":2,\"prospect_0_5km_Max_BW_Mbps\":0.0,\"offnet_0_5km_Min_accuracy_num\":0.0,\"product_name\":\"Internet Access Service\",\"closest_provider\":\"tikona_min_dist_km\",\"lm_arc_bw_onwl\":0.0,\"nearest_mast_ht_cost\":56400.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Tikona\",\"lm_nrc_mux_onwl\":0.0,\"offnet_2km_Avg_BW_Mbps\":1.256,\"offnet_2km_Min_accuracy_num\":50.0,\"cust_count\":132.0,\"offnet_0_5km_Avg_BW_Mbps\":0.0,\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"nearest_mast_ht\":18.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"Longitude_final\":80.18774819999999,\"Last.Mile.Contract.Term\":\"1 Year\",\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"offnet_0_5km_Min_DistanceKilometers\":99999.0,\"offnet_0_5km_cust_Count\":0.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"Probabililty_Access_Feasibility\":0.9666666666666667,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\"}],\"NotFeasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"Mast_3KM_avg_mast_ht\":9.696969696969697,\"solution_type\":\"UBRP2P\",\"onnet_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_prov_ofrf\":0.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"Mast_3KM_cust_count\":132.0,\"Network_Feasibility_Check\":\"Not Feasible\",\"interim_BW\":0.064,\"onnet_0_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":\"16000\",\"prospect_0_5km_Min_BW_Mbps\":0.0,\"onnet_5km_cust_Count\":0.0,\"lm_nrc_bw_prov_ofrf\":0.0,\"onnet_0_5km_cust_Count\":0.0,\"local_loop_interface\":\"FE\",\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"Mast_3KM_nearest_mast_ht\":9.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"prospect_2km_feasibility_pct\":0.9375,\"Orch_Connection\":\"Wireless\",\"Backhaul_Network_check\":\"Not Feasible\\/ Manual\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"onnet_2km_Avg_BW_Mbps\":0.0,\"opportunity_term\":12,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4655595863714428,\"prospect_2km_Sum_Feasibility_flag\":30.0,\"prospect_2km_Avg_BW_Mbps\":10.845,\"Orch_LM_Type\":\"Onnet\",\"onnet_2km_cust_Count\":0.0,\"lm_nrc_mast_ofrf\":0.0,\"onnet_5km_Max_BW_Mbps\":0.0,\"lm_nrc_mast_onrf\":\"17375.7575757576\",\"connection_type\":\"Premium\",\"onnet_0_5km_Min_DistanceKilometers\":99999.0,\"pool_size\":0,\"Mast_3KM_min_mast_ht\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"Nearest_Mast_ht_cost\":14100.0,\"time_taken\":3.25,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Type\":\"OnnetRF\",\"bts_Closest_Site_type\":\"Roof Top\",\"longitude_final\":80.18774819999999,\"Orch_BW\":0.0,\"LM_OTC_INR\":\"27000\",\"Interface\":\"FE\",\"prospect_2km_Max_BW_Mbps\":300.0,\"onnet_2km_Min_BW_Mbps\":0.0,\"Selected_solution_BW\":0.0,\"prospect_name\":\"Kasturi & Sons Limited\",\"PMP_bts_3km_radius\":0.0,\"Predicted_Access_Feasibility\":\"Not Feasible\",\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"Backhaul_Network_check_reason\":\"UBRP2P Solution\",\"onnet_2km_Avg_DistanceKilometers\":99999.0,\"Avg_3KM_Mast_ht_cost\":17375.757575757576,\"burstable_bw\":0,\"bw_mbps\":2,\"bts_flag\":1.0,\"bts_IP_PMP\":\"Not_in_range\",\"prospect_0_5km_Max_BW_Mbps\":0.0,\"product_name\":\"Internet Access Service\",\"LM_ARC_INR\":\"16000\",\"bts_min_dist_km\":0.7344931438623558,\"lm_arc_bw_onwl\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"UBR P2P - Onnet\",\"lm_nrc_mux_onwl\":0.0,\"bts_num_BTS\":\"TANCHE0158#P2PMP\",\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"Sector_network_check\":\"Feasible\",\"Bandwidth\":\"64K\",\"P2P_bts_3km_radius\":4.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"onnet_5km_Avg_DistanceKilometers\":99999.0,\"sum_no_of_sites_uni_len\":1,\"onnet_2km_Max_BW_Mbps\":0.0,\"onnet_5km_Min_BW_Mbps\":0.0,\"LM_Cost\":60375.757575757576,\"Mast_3KM_max_mast_ht\":27.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"bts_Closest_infra_provider\":\"ATC\",\"Probabililty_Access_Feasibility\":0.43333333333333335,\"lm_nrc_bw_onrf\":\"27000\",\"quotetype_quote\":\"New Order\"}]}");
	}

	/**
	 * 
	 * @throws TclCommonException
	 */
	@Test
	public void testFeasibilityEngineListnerTestInternetPort() throws TclCommonException {
		Mockito.when(illSiteRepository.findById(Mockito.anyInt())).thenReturn(Optional.of(objectCreator.getIllsites()));
		Mockito.when(mstOmsAttributeRepository.findByNameAndIsActive(Mockito.anyString(), Mockito.anyByte()))
				.thenReturn(objectCreator.getMstAttributeList());
		Mockito.when(quoteLeAttributeValueRepository.findByQuoteToLeAndMstOmsAttribute(Mockito.any(), Mockito.any()))
				.thenReturn(objectCreator.getQuoteLeAttributeValueList());
		Mockito.when(siteFeasibilityRepository.findByQuoteIllSiteAndFeasibilityMode(Mockito.any(), Mockito.anyString()))
				.thenReturn(objectCreator.getSiteFeasibilities());
		Mockito.when(siteFeasibilityRepository.save(Mockito.any())).thenReturn(new SiteFeasibility());
		Mockito.when(quoteToLeRepository.save(Mockito.any())).thenReturn(new QuoteToLe());
		Mockito.when(pricingDetailsRepository.save(Mockito.any())).thenReturn(new PricingEngineResponse());
		Mockito.when(restClientService.post(Mockito.anyString(), Mockito.any()))
				.thenReturn(objectCreator.cretateResponse());
		Mockito.when(quoteProductComponentRepository.findByReferenceIdAndType(Mockito.anyInt(), Mockito.anyString()))
				.thenReturn(objectCreator.getQuoteProductComponent());
		Mockito.when(mstProductComponentRepository.findById(Mockito.anyInt()))
				.thenReturn(Optional.of(objectCreator.getMstProductComponent2()));
		Mockito.when(quotePriceRepository.save(Mockito.any())).thenReturn(new QuotePrice());
		Mockito.when(illSiteRepository.findByIdAndStatus(Mockito.anyInt(), Mockito.anyByte()))
				.thenReturn(objectCreator.getQuoteIllSite());
		Mockito.when(quoteProductComponentsAttributeValueRepository
				.findByQuoteProductComponent_Id(Mockito.anyInt()))
				.thenReturn(objectCreator.getquoteProductComponentAttributeValues());
		Mockito.when(productAttributeMasterRepository.findById(Mockito.anyInt()))
				.thenReturn(Optional.of(objectCreator.getProductAtrributeMas()));
		Mockito.when(quotePriceRepository.findByReferenceIdAndReferenceName(Mockito.anyString(), Mockito.anyString()))
				.thenReturn(null);
		Mockito.when(quotePriceRepository.save(Mockito.any())).thenReturn(new QuotePrice());

		feasibilityEngineListner.processFeasibility(
				"{\"Feasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"BW_mbps_2\":2.0,\"Service_ID\":0.0,\"total_cost\":132160.0,\"X0.5km_avg_dist\":9999999.0,\"POP_DIST_KM\":0.5100730350500826,\"X0.5km_prospect_avg_bw\":45.2727272727273,\"Latitude_final\":13.0184111,\"OnnetCity_tag\":1.0,\"lm_arc_bw_prov_ofrf\":0.0,\"Network_F_NF_CC\":\"NA\",\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":40000.0,\"Network_Feasibility_Check\":\"Feasible\",\"core_check_CC\":\"NA\",\"X5km_min_bw\":120.0,\"access_check_CC\":\"NA\",\"rank\":10,\"POP_DIST_KM_SERVICE_MOD\":15.0,\"X5km_max_bw\":200.0,\"X5km_prospect_perc_feasible\":0.926775147928994,\"lm_arc_bw_onrf\":0.0,\"POP_Category\":\"Metro Service Ready\",\"lm_nrc_bw_prov_ofrf\":0.0,\"FATG_Building_Type\":\"Commercial\",\"HH_0_5_access_rings_F\":\"NA\",\"hh_flag\":\"NA\",\"local_loop_interface\":\"FE\",\"X5km_prospect_avg_dist\":2738.92671182687,\"latitude_final\":13.0184111,\"FATG_Network_Location_Type\":\"Access\\/Customer POP\",\"topology\":\"primary_active\",\"BW_mbps_act\":2.0,\"city_tier\":\"Non_Tier1\",\"lm_nrc_bw_onwl\":0.0,\"X2km_prospect_min_dist\":2.21569108223123,\"X2km_prospect_perc_feasible\":0.94300518134715,\"X0.5km_prospect_num_feasible\":33.0,\"cpe_supply_type\":\"rental\",\"Orch_Connection\":\"Wireline\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"Capex\":\"NA\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"Burstable_BW\":0.0,\"connected_cust_tag\":0.0,\"net_pre_feasible_flag\":1.0,\"Network_F_NF_CC_Flag\":\"NA\",\"Orch_LM_Type\":\"Onnet\",\"X5km_prospect_avg_bw\":201.780650887574,\"FATG_Category\":\"Metro Service Ready\",\"lm_nrc_mast_ofrf\":0.0,\"Feasibility.Response..Created.Date\":17730.0,\"X2km_prospect_min_bw\":2.0,\"X5km_prospect_num_feasible\":1253.0,\"Selected\":false,\"lm_nrc_mast_onrf\":0.0,\"X5km_prospect_count\":1352.0,\"connection_type\":\"Premium\",\"X0.5km_avg_bw\":9999999.0,\"pool_size\":0,\"X2km_cust_count\":2.0,\"Customer_Segment\":\"Enterprise - Strategic\",\"customer_segment\":\"Enterprise - Strategic\",\"FATG_PROW\":\"No\",\"connected_building_tag\":0.0,\"FATG_DIST_KM\":41.33379039696604,\"X0.5km_prospect_max_bw\":500.0,\"X5km_prospect_min_dist\":2.21569108223123,\"Type\":\"OnnetWL\",\"FATG_Ring_type\":\"SDH\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"scenario_1\":0.0,\"scenario_2\":1.0,\"sno\":3,\"access_check_hh\":\"NA\",\"X2km_prospect_count\":386.0,\"min_hh_fatg\":41.33379039696604,\"POP_Construction_Status\":\"In Service\",\"X5km_avg_dist\":1616.32490273161,\"X2km_avg_dist\":1616.32490273161,\"X2km_prospect_avg_bw\":390.502590673575,\"X0.5km_prospect_min_dist\":2.21569108223123,\"cost_permeter\":0.0,\"Identifier\":\"NA\",\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"X2km_max_bw\":200.0,\"X2km_prospect_max_bw\":10240.0,\"last_mile_contract_term\":\"1 Year\",\"X5km_prospect_min_bw\":0.064,\"X2km_min_bw\":120.0,\"burstable_bw\":0,\"seq_no\":141,\"bw_mbps\":2,\"X0.5km_cust_count\":0.0,\"X0.5km_min_bw\":9999999.0,\"product_name\":\"Internet Access Service\",\"Network_F_NF_HH\":\"NA\",\"HH_0_5_access_rings_NF\":\"NA\",\"X0.5km_min_dist\":9999999.0,\"POP_Building_Type\":\"Commercial\",\"core_check_hh\":\"NA\",\"HH_DIST_KM\":48.632402798319305,\"X0.5km_prospect_min_bw\":2.0,\"POP_DIST_KM_SERVICE\":14.152705282191185,\"lm_arc_bw_onwl\":33350.0,\"num_connected_building\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Capex less than 175m\",\"X0.5km_prospect_avg_dist\":243.087859734992,\"POP_Network_Location_Type\":\"Mega POP\",\"lm_nrc_mux_onwl\":58810.0,\"num_connected_cust\":0.0,\"HH_0_5km\":\"NA\",\"X5km_min_dist\":1424.59360546586,\"feasibility_response_created_date\":\"2018-07-18\",\"X2km_prospect_num_feasible\":364.0,\"additional_ip\":0,\"X2km_avg_bw\":160.0,\"X0.5km_max_bw\":9999999.0,\"X5km_avg_bw\":160.0,\"Status.v2\":\"NA\",\"X5km_prospect_max_bw\":10240.0,\"X2km_prospect_avg_dist\":1361.96557355991,\"cpe_variant\":\"None\",\"Longitude_final\":80.18774819999999,\"X5km_cust_count\":2.0,\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"X0.5km_prospect_perc_feasible\":1.0,\"POP_TCL_Access\":\"Yes\",\"X0.5km_prospect_count\":33.0,\"Probabililty_Access_Feasibility\":0.8533333333333334,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\",\"X2km_min_dist\":1424.59360546586,\"FATG_TCL_Access\":\"No\",\"Network_F_NF_HH_Flag\":\"NA\"},{\"lm_nrc_ospcapex_onwl\":0.0,\"total_cost\":62375.757575757576,\"otc_tikona\":10000.0,\"Latitude_final\":13.0184111,\"lm_arc_bw_prov_ofrf\":35000.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"offnet_5km_Min_accuracy_num\":50.0,\"interim_BW\":2.0,\"offnet_5km_Min_DistanceKilometers\":1.2178610509953627,\"rank\":5,\"offnet_0_5km_Max_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":0.0,\"prospect_0_5km_Min_BW_Mbps\":0.0,\"lm_nrc_bw_prov_ofrf\":10000.0,\"local_loop_interface\":\"FE\",\"bw_flag_32\":0.0,\"arc_tikona\":35000.0,\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"min_mast_ht\":0.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"offnet_2km_Min_DistanceKilometers\":1.2178610509953627,\"prospect_2km_feasibility_pct\":0.7636363636363637,\"Orch_Connection\":\"Wireless\",\"bw_flag_3\":0.0,\"offnet_2km_cust_Count\":2.0,\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4529000280961837,\"offnet_5km_Max_BW_Mbps\":16.0,\"prospect_2km_Sum_Feasibility_flag\":42.0,\"arc_sify\":45000.0,\"prospect_2km_Avg_BW_Mbps\":2.343709090909091,\"Orch_LM_Type\":\"Offnet\",\"max_mast_ht\":27.0,\"lm_nrc_mast_ofrf\":17375.757575757576,\"Feasibility.Response..Created.Date\":17730.0,\"Selected\":true,\"provider_tot_towers\":0.0,\"lm_nrc_mast_onrf\":0.0,\"connection_type\":\"Premium\",\"offnet_2km_Min_BW_Mbps\":0.512,\"pool_size\":0,\"offnet_0_5km_Min_BW_Mbps\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"offnet_5km_Avg_BW_Mbps\":1.7612,\"time_taken\":3.1749999999883585,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Local.Loop.Interface\":\"FE\",\"prospect_2km_cust_Count\":55.0,\"Type\":\"OffnetRF\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"prospect_2km_Max_BW_Mbps\":20.0,\"otc_sify\":15000.0,\"Customer.Segment\":\"Enterprise - Strategic\",\"provider_min_dist\":0.7138602916391107,\"offnet_5km_Min_BW_Mbps\":0.128,\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"avg_mast_ht\":9.696969696969697,\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"burstable_bw\":0,\"bw_mbps\":2,\"prospect_0_5km_Max_BW_Mbps\":0.0,\"offnet_0_5km_Min_accuracy_num\":0.0,\"product_name\":\"Internet Access Service\",\"closest_provider\":\"tikona_min_dist_km\",\"lm_arc_bw_onwl\":0.0,\"nearest_mast_ht_cost\":56400.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Tikona\",\"lm_nrc_mux_onwl\":0.0,\"offnet_2km_Avg_BW_Mbps\":1.256,\"offnet_2km_Min_accuracy_num\":50.0,\"cust_count\":132.0,\"offnet_0_5km_Avg_BW_Mbps\":0.0,\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"nearest_mast_ht\":18.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"Longitude_final\":80.18774819999999,\"Last.Mile.Contract.Term\":\"1 Year\",\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"offnet_0_5km_Min_DistanceKilometers\":99999.0,\"offnet_0_5km_cust_Count\":0.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"Probabililty_Access_Feasibility\":0.9666666666666667,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\"}],\"NotFeasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"Mast_3KM_avg_mast_ht\":9.696969696969697,\"solution_type\":\"UBRP2P\",\"onnet_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_prov_ofrf\":0.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"Mast_3KM_cust_count\":132.0,\"Network_Feasibility_Check\":\"Not Feasible\",\"interim_BW\":0.064,\"onnet_0_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":\"16000\",\"prospect_0_5km_Min_BW_Mbps\":0.0,\"onnet_5km_cust_Count\":0.0,\"lm_nrc_bw_prov_ofrf\":0.0,\"onnet_0_5km_cust_Count\":0.0,\"local_loop_interface\":\"FE\",\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"Mast_3KM_nearest_mast_ht\":9.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"prospect_2km_feasibility_pct\":0.9375,\"Orch_Connection\":\"Wireless\",\"Backhaul_Network_check\":\"Not Feasible\\/ Manual\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"onnet_2km_Avg_BW_Mbps\":0.0,\"opportunity_term\":12,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4655595863714428,\"prospect_2km_Sum_Feasibility_flag\":30.0,\"prospect_2km_Avg_BW_Mbps\":10.845,\"Orch_LM_Type\":\"Onnet\",\"onnet_2km_cust_Count\":0.0,\"lm_nrc_mast_ofrf\":0.0,\"onnet_5km_Max_BW_Mbps\":0.0,\"lm_nrc_mast_onrf\":\"17375.7575757576\",\"connection_type\":\"Premium\",\"onnet_0_5km_Min_DistanceKilometers\":99999.0,\"pool_size\":0,\"Mast_3KM_min_mast_ht\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"Nearest_Mast_ht_cost\":14100.0,\"time_taken\":3.25,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Type\":\"OnnetRF\",\"bts_Closest_Site_type\":\"Roof Top\",\"longitude_final\":80.18774819999999,\"Orch_BW\":0.0,\"LM_OTC_INR\":\"27000\",\"Interface\":\"FE\",\"prospect_2km_Max_BW_Mbps\":300.0,\"onnet_2km_Min_BW_Mbps\":0.0,\"Selected_solution_BW\":0.0,\"prospect_name\":\"Kasturi & Sons Limited\",\"PMP_bts_3km_radius\":0.0,\"Predicted_Access_Feasibility\":\"Not Feasible\",\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"Backhaul_Network_check_reason\":\"UBRP2P Solution\",\"onnet_2km_Avg_DistanceKilometers\":99999.0,\"Avg_3KM_Mast_ht_cost\":17375.757575757576,\"burstable_bw\":0,\"bw_mbps\":2,\"bts_flag\":1.0,\"bts_IP_PMP\":\"Not_in_range\",\"prospect_0_5km_Max_BW_Mbps\":0.0,\"product_name\":\"Internet Access Service\",\"LM_ARC_INR\":\"16000\",\"bts_min_dist_km\":0.7344931438623558,\"lm_arc_bw_onwl\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"UBR P2P - Onnet\",\"lm_nrc_mux_onwl\":0.0,\"bts_num_BTS\":\"TANCHE0158#P2PMP\",\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"Sector_network_check\":\"Feasible\",\"Bandwidth\":\"64K\",\"P2P_bts_3km_radius\":4.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"onnet_5km_Avg_DistanceKilometers\":99999.0,\"sum_no_of_sites_uni_len\":1,\"onnet_2km_Max_BW_Mbps\":0.0,\"onnet_5km_Min_BW_Mbps\":0.0,\"LM_Cost\":60375.757575757576,\"Mast_3KM_max_mast_ht\":27.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"bts_Closest_infra_provider\":\"ATC\",\"Probabililty_Access_Feasibility\":0.43333333333333335,\"lm_nrc_bw_onrf\":\"27000\",\"quotetype_quote\":\"New Order\"}]}");
	}

	/**
	 * 
	 * @throws TclCommonException
	 */
	@Test
	public void testFeasibilityEngineListnerTestAddon() throws TclCommonException {
		Mockito.when(illSiteRepository.findById(Mockito.anyInt())).thenReturn(Optional.of(objectCreator.getIllsites()));
		Mockito.when(mstOmsAttributeRepository.findByNameAndIsActive(Mockito.anyString(), Mockito.anyByte()))
				.thenReturn(objectCreator.getMstAttributeList());
		Mockito.when(quoteLeAttributeValueRepository.findByQuoteToLeAndMstOmsAttribute(Mockito.any(), Mockito.any()))
				.thenReturn(objectCreator.getQuoteLeAttributeValueList());
		Mockito.when(siteFeasibilityRepository.findByQuoteIllSiteAndFeasibilityMode(Mockito.any(), Mockito.anyString()))
				.thenReturn(objectCreator.getSiteFeasibilities());
		Mockito.when(siteFeasibilityRepository.save(Mockito.any())).thenReturn(new SiteFeasibility());
		Mockito.when(quoteToLeRepository.save(Mockito.any())).thenReturn(new QuoteToLe());
		Mockito.when(pricingDetailsRepository.save(Mockito.any())).thenReturn(new PricingEngineResponse());
		Mockito.when(restClientService.post(Mockito.anyString(), Mockito.any()))
				.thenReturn(objectCreator.cretateResponse());
		Mockito.when(quoteProductComponentRepository.findByReferenceIdAndType(Mockito.anyInt(), Mockito.anyString()))
				.thenReturn(objectCreator.getQuoteProductComponent());
		Mockito.when(mstProductComponentRepository.findById(Mockito.anyInt()))
				.thenReturn(Optional.of(objectCreator.getMstProductComponent3()));
		Mockito.when(quotePriceRepository.save(Mockito.any())).thenReturn(new QuotePrice());
		Mockito.when(illSiteRepository.findByIdAndStatus(Mockito.anyInt(), Mockito.anyByte()))
				.thenReturn(objectCreator.getQuoteIllSite());

		feasibilityEngineListner.processFeasibility(
				"{\"Feasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"BW_mbps_2\":2.0,\"Service_ID\":0.0,\"total_cost\":132160.0,\"X0.5km_avg_dist\":9999999.0,\"POP_DIST_KM\":0.5100730350500826,\"X0.5km_prospect_avg_bw\":45.2727272727273,\"Latitude_final\":13.0184111,\"OnnetCity_tag\":1.0,\"lm_arc_bw_prov_ofrf\":0.0,\"Network_F_NF_CC\":\"NA\",\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":40000.0,\"Network_Feasibility_Check\":\"Feasible\",\"core_check_CC\":\"NA\",\"X5km_min_bw\":120.0,\"access_check_CC\":\"NA\",\"rank\":10,\"POP_DIST_KM_SERVICE_MOD\":15.0,\"X5km_max_bw\":200.0,\"X5km_prospect_perc_feasible\":0.926775147928994,\"lm_arc_bw_onrf\":0.0,\"POP_Category\":\"Metro Service Ready\",\"lm_nrc_bw_prov_ofrf\":0.0,\"FATG_Building_Type\":\"Commercial\",\"HH_0_5_access_rings_F\":\"NA\",\"hh_flag\":\"NA\",\"local_loop_interface\":\"FE\",\"X5km_prospect_avg_dist\":2738.92671182687,\"latitude_final\":13.0184111,\"FATG_Network_Location_Type\":\"Access\\/Customer POP\",\"topology\":\"primary_active\",\"BW_mbps_act\":2.0,\"city_tier\":\"Non_Tier1\",\"lm_nrc_bw_onwl\":0.0,\"X2km_prospect_min_dist\":2.21569108223123,\"X2km_prospect_perc_feasible\":0.94300518134715,\"X0.5km_prospect_num_feasible\":33.0,\"cpe_supply_type\":\"rental\",\"Orch_Connection\":\"Wireline\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"Capex\":\"NA\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"Burstable_BW\":0.0,\"connected_cust_tag\":0.0,\"net_pre_feasible_flag\":1.0,\"Network_F_NF_CC_Flag\":\"NA\",\"Orch_LM_Type\":\"Onnet\",\"X5km_prospect_avg_bw\":201.780650887574,\"FATG_Category\":\"Metro Service Ready\",\"lm_nrc_mast_ofrf\":0.0,\"Feasibility.Response..Created.Date\":17730.0,\"X2km_prospect_min_bw\":2.0,\"X5km_prospect_num_feasible\":1253.0,\"Selected\":false,\"lm_nrc_mast_onrf\":0.0,\"X5km_prospect_count\":1352.0,\"connection_type\":\"Premium\",\"X0.5km_avg_bw\":9999999.0,\"pool_size\":0,\"X2km_cust_count\":2.0,\"Customer_Segment\":\"Enterprise - Strategic\",\"customer_segment\":\"Enterprise - Strategic\",\"FATG_PROW\":\"No\",\"connected_building_tag\":0.0,\"FATG_DIST_KM\":41.33379039696604,\"X0.5km_prospect_max_bw\":500.0,\"X5km_prospect_min_dist\":2.21569108223123,\"Type\":\"OnnetWL\",\"FATG_Ring_type\":\"SDH\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"scenario_1\":0.0,\"scenario_2\":1.0,\"sno\":3,\"access_check_hh\":\"NA\",\"X2km_prospect_count\":386.0,\"min_hh_fatg\":41.33379039696604,\"POP_Construction_Status\":\"In Service\",\"X5km_avg_dist\":1616.32490273161,\"X2km_avg_dist\":1616.32490273161,\"X2km_prospect_avg_bw\":390.502590673575,\"X0.5km_prospect_min_dist\":2.21569108223123,\"cost_permeter\":0.0,\"Identifier\":\"NA\",\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"X2km_max_bw\":200.0,\"X2km_prospect_max_bw\":10240.0,\"last_mile_contract_term\":\"1 Year\",\"X5km_prospect_min_bw\":0.064,\"X2km_min_bw\":120.0,\"burstable_bw\":0,\"seq_no\":141,\"bw_mbps\":2,\"X0.5km_cust_count\":0.0,\"X0.5km_min_bw\":9999999.0,\"product_name\":\"Internet Access Service\",\"Network_F_NF_HH\":\"NA\",\"HH_0_5_access_rings_NF\":\"NA\",\"X0.5km_min_dist\":9999999.0,\"POP_Building_Type\":\"Commercial\",\"core_check_hh\":\"NA\",\"HH_DIST_KM\":48.632402798319305,\"X0.5km_prospect_min_bw\":2.0,\"POP_DIST_KM_SERVICE\":14.152705282191185,\"lm_arc_bw_onwl\":33350.0,\"num_connected_building\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Capex less than 175m\",\"X0.5km_prospect_avg_dist\":243.087859734992,\"POP_Network_Location_Type\":\"Mega POP\",\"lm_nrc_mux_onwl\":58810.0,\"num_connected_cust\":0.0,\"HH_0_5km\":\"NA\",\"X5km_min_dist\":1424.59360546586,\"feasibility_response_created_date\":\"2018-07-18\",\"X2km_prospect_num_feasible\":364.0,\"additional_ip\":0,\"X2km_avg_bw\":160.0,\"X0.5km_max_bw\":9999999.0,\"X5km_avg_bw\":160.0,\"Status.v2\":\"NA\",\"X5km_prospect_max_bw\":10240.0,\"X2km_prospect_avg_dist\":1361.96557355991,\"cpe_variant\":\"None\",\"Longitude_final\":80.18774819999999,\"X5km_cust_count\":2.0,\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"X0.5km_prospect_perc_feasible\":1.0,\"POP_TCL_Access\":\"Yes\",\"X0.5km_prospect_count\":33.0,\"Probabililty_Access_Feasibility\":0.8533333333333334,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\",\"X2km_min_dist\":1424.59360546586,\"FATG_TCL_Access\":\"No\",\"Network_F_NF_HH_Flag\":\"NA\"},{\"lm_nrc_ospcapex_onwl\":0.0,\"total_cost\":62375.757575757576,\"otc_tikona\":10000.0,\"Latitude_final\":13.0184111,\"lm_arc_bw_prov_ofrf\":35000.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"offnet_5km_Min_accuracy_num\":50.0,\"interim_BW\":2.0,\"offnet_5km_Min_DistanceKilometers\":1.2178610509953627,\"rank\":5,\"offnet_0_5km_Max_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":0.0,\"prospect_0_5km_Min_BW_Mbps\":0.0,\"lm_nrc_bw_prov_ofrf\":10000.0,\"local_loop_interface\":\"FE\",\"bw_flag_32\":0.0,\"arc_tikona\":35000.0,\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"min_mast_ht\":0.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"offnet_2km_Min_DistanceKilometers\":1.2178610509953627,\"prospect_2km_feasibility_pct\":0.7636363636363637,\"Orch_Connection\":\"Wireless\",\"bw_flag_3\":0.0,\"offnet_2km_cust_Count\":2.0,\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"opportunity_term\":12,\"BW_mbps\":2.0,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4529000280961837,\"offnet_5km_Max_BW_Mbps\":16.0,\"prospect_2km_Sum_Feasibility_flag\":42.0,\"arc_sify\":45000.0,\"prospect_2km_Avg_BW_Mbps\":2.343709090909091,\"Orch_LM_Type\":\"Offnet\",\"max_mast_ht\":27.0,\"lm_nrc_mast_ofrf\":17375.757575757576,\"Feasibility.Response..Created.Date\":17730.0,\"Selected\":true,\"provider_tot_towers\":0.0,\"lm_nrc_mast_onrf\":0.0,\"connection_type\":\"Premium\",\"offnet_2km_Min_BW_Mbps\":0.512,\"pool_size\":0,\"offnet_0_5km_Min_BW_Mbps\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"offnet_5km_Avg_BW_Mbps\":1.7612,\"time_taken\":3.1749999999883585,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Local.Loop.Interface\":\"FE\",\"prospect_2km_cust_Count\":55.0,\"Type\":\"OffnetRF\",\"longitude_final\":80.18774819999999,\"Orch_BW\":2.0,\"prospect_2km_Max_BW_Mbps\":20.0,\"otc_sify\":15000.0,\"Customer.Segment\":\"Enterprise - Strategic\",\"provider_min_dist\":0.7138602916391107,\"offnet_5km_Min_BW_Mbps\":0.128,\"prospect_name\":\"Kasturi & Sons Limited\",\"Predicted_Access_Feasibility\":\"Feasible\",\"avg_mast_ht\":9.696969696969697,\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"burstable_bw\":0,\"bw_mbps\":2,\"prospect_0_5km_Max_BW_Mbps\":0.0,\"offnet_0_5km_Min_accuracy_num\":0.0,\"product_name\":\"Internet Access Service\",\"closest_provider\":\"tikona_min_dist_km\",\"lm_arc_bw_onwl\":0.0,\"nearest_mast_ht_cost\":56400.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"Tikona\",\"lm_nrc_mux_onwl\":0.0,\"offnet_2km_Avg_BW_Mbps\":1.256,\"offnet_2km_Min_accuracy_num\":50.0,\"cust_count\":132.0,\"offnet_0_5km_Avg_BW_Mbps\":0.0,\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"nearest_mast_ht\":18.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"Longitude_final\":80.18774819999999,\"Last.Mile.Contract.Term\":\"1 Year\",\"sum_no_of_sites_uni_len\":1,\"Product.Name\":\"Internet Access Service\",\"offnet_0_5km_Min_DistanceKilometers\":99999.0,\"offnet_0_5km_cust_Count\":0.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"Probabililty_Access_Feasibility\":0.9666666666666667,\"lm_nrc_bw_onrf\":0.0,\"quotetype_quote\":\"New Order\"}],\"NotFeasible\":[{\"lm_nrc_ospcapex_onwl\":0.0,\"Mast_3KM_avg_mast_ht\":9.696969696969697,\"solution_type\":\"UBRP2P\",\"onnet_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_prov_ofrf\":0.0,\"lm_nrc_nerental_onwl\":0.0,\"lm_nrc_inbldg_onwl\":0.0,\"Mast_3KM_cust_count\":132.0,\"Network_Feasibility_Check\":\"Not Feasible\",\"interim_BW\":0.064,\"onnet_0_5km_Avg_BW_Mbps\":0.0,\"lm_arc_bw_onrf\":\"16000\",\"prospect_0_5km_Min_BW_Mbps\":0.0,\"onnet_5km_cust_Count\":0.0,\"lm_nrc_bw_prov_ofrf\":0.0,\"onnet_0_5km_cust_Count\":0.0,\"local_loop_interface\":\"FE\",\"latitude_final\":13.0184111,\"topology\":\"primary_active\",\"Mast_3KM_nearest_mast_ht\":9.0,\"lm_nrc_bw_onwl\":0.0,\"cpe_supply_type\":\"rental\",\"prospect_2km_feasibility_pct\":0.9375,\"Orch_Connection\":\"Wireless\",\"Backhaul_Network_check\":\"Not Feasible\\/ Manual\",\"site_id\":\"607_primary\",\"cpe_management_type\":\"Fully Managed\",\"sales_org\":\"Enterprise\",\"onnet_2km_Avg_BW_Mbps\":0.0,\"opportunity_term\":12,\"resp_city\":\"Tiruvallur\",\"prospect_2km_Avg_DistanceKilometers\":1.4655595863714428,\"prospect_2km_Sum_Feasibility_flag\":30.0,\"prospect_2km_Avg_BW_Mbps\":10.845,\"Orch_LM_Type\":\"Onnet\",\"onnet_2km_cust_Count\":0.0,\"lm_nrc_mast_ofrf\":0.0,\"onnet_5km_Max_BW_Mbps\":0.0,\"lm_nrc_mast_onrf\":\"17375.7575757576\",\"connection_type\":\"Premium\",\"onnet_0_5km_Min_DistanceKilometers\":99999.0,\"pool_size\":0,\"Mast_3KM_min_mast_ht\":0.0,\"customer_segment\":\"Enterprise - Strategic\",\"Nearest_Mast_ht_cost\":14100.0,\"time_taken\":3.25,\"prospect_0_5km_Sum_Feasibility_flag\":0.0,\"Type\":\"OnnetRF\",\"bts_Closest_Site_type\":\"Roof Top\",\"longitude_final\":80.18774819999999,\"Orch_BW\":0.0,\"LM_OTC_INR\":\"27000\",\"Interface\":\"FE\",\"prospect_2km_Max_BW_Mbps\":300.0,\"onnet_2km_Min_BW_Mbps\":0.0,\"Selected_solution_BW\":0.0,\"prospect_name\":\"Kasturi & Sons Limited\",\"PMP_bts_3km_radius\":0.0,\"Predicted_Access_Feasibility\":\"Not Feasible\",\"last_mile_contract_term\":\"1 Year\",\"prospect_0_5km_feasibility_pct\":0.0,\"Backhaul_Network_check_reason\":\"UBRP2P Solution\",\"onnet_2km_Avg_DistanceKilometers\":99999.0,\"Avg_3KM_Mast_ht_cost\":17375.757575757576,\"burstable_bw\":0,\"bw_mbps\":2,\"bts_flag\":1.0,\"bts_IP_PMP\":\"Not_in_range\",\"prospect_0_5km_Max_BW_Mbps\":0.0,\"product_name\":\"Internet Access Service\",\"LM_ARC_INR\":\"16000\",\"bts_min_dist_km\":0.7344931438623558,\"lm_arc_bw_onwl\":0.0,\"account_id_with_18_digit\":\"0012000000E1z9KAAR\",\"Orch_Category\":\"UBR P2P - Onnet\",\"lm_nrc_mux_onwl\":0.0,\"bts_num_BTS\":\"TANCHE0158#P2PMP\",\"feasibility_response_created_date\":\"2018-07-18\",\"prospect_0_5km_Min_DistanceKilometers\":99999.0,\"additional_ip\":0,\"Sector_network_check\":\"Feasible\",\"Bandwidth\":\"64K\",\"P2P_bts_3km_radius\":4.0,\"cpe_variant\":\"None\",\"prospect_2km_Min_BW_Mbps\":0.064,\"onnet_5km_Avg_DistanceKilometers\":99999.0,\"sum_no_of_sites_uni_len\":1,\"onnet_2km_Max_BW_Mbps\":0.0,\"onnet_5km_Min_BW_Mbps\":0.0,\"LM_Cost\":60375.757575757576,\"Mast_3KM_max_mast_ht\":27.0,\"prospect_0_5km_Avg_BW_Mbps\":0.0,\"bts_Closest_infra_provider\":\"ATC\",\"Probabililty_Access_Feasibility\":0.43333333333333335,\"lm_nrc_bw_onrf\":\"27000\",\"quotetype_quote\":\"New Order\"}]}");
	}


	

}
